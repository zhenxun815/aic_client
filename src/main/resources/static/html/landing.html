<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<meta content="ie=edge" http-equiv="X-UA-Compatible">
	<!-- 公共样式 -->
	<link href="../css/common.css" rel="stylesheet">
	<link href="../css/landing.css" rel="stylesheet">
	<!-- layui样式 -->
	<link href="../layui/css/layui.css" rel="stylesheet">
	<!-- 引入rem -->
	<script src="../js/rem.js" type="text/javascript"></script>
	<!-- 引入layui -->
	<script src="../layui/layui.js" type="text/javascript"></script>
	<!-- 载入layui -->
	<script src="../js/common.js" type="text/javascript"></script>
	<title>AIOS 让AI触手可及</title>
</head>
<body>
<div class="main">
	<div class="left">
		<div class="box">
			<p class="word">让AI触手可及</p>
		</div>
	</div>
	<div class="right">
		<div class="inner">
			<div class="core">
				<h1 class="title">登录</h1>
				<form class="login-zone" onsubmit="return false">
					<div class="input-box user">
						<h6 class="label">用户名</h6>
						<input class="input" id="input_uname" placeholder="填写用户名"
						       type="text"/>
						<p class="callback-message">用户名不能为空</p>
					</div>
					<div class="input-box user">
						<h6 class="label">密码</h6>
						<input class="input" id="input_upwd" placeholder="填写密码"
						       type="password"/>
						<p class="callback-message" id="landing_tips">密码不能为空</p>
					</div>
				</form>
				<div class="button-zone">
					<button class="button" onclick="land()">
						<span class="img"></span>
					</button>
				</div>
			</div>
			<p class="copyright">天启慧眼(北京)信息技术有限公司 </p>
		</div>
	</div>
</div>

<!-- 异常提示 -->
<div class="lay lay1" style="display:none">
	<div class="inner">
		<div class="icon"></div>
		<div class="word">
			<p>异常提示</p>
			<p>客户端启动异常：客户端连接数超过数量上限；</p>
		</div>
		<div class="button-zone">
			<button class="button" id="enter_program" onclick="confirm()">确认</button>
		</div>
	</div>
</div>
</body>
<script type="text/javascript">
	document.oncontextmenu = function () {
		return false;
	}

	window.onload = () => {
		get_ajax("getUserName", "/user/name", (response) => {
			console.log(`user name is: ${response}`)
			if (response) {
				$('#input_uname').val(response)
			}
		});
	};
	/*layui.use(['jquery'], function () {
		layer = layui.layer;
		$ = layui.jquery;



	});*/


	document.body.addEventListener('keyup', function (e) {
		if (e.keyCode === 13) {
			land()
		}
	})

	let inputLengthValid = false

	function checkInputLength() {
		let nameLength = $('#input_uname').value
		let pwdLength = $('#input_upwd').value
		if (nameLength.length > 50 || pwdLength.length > 50) {
			$('#landing_tips').html('输入长度不合法,请重新输入!')
			$('#landing_tips').show()
			return false
		} else {
			$('#landing_tips').hide()
			return true
		}
	}

	function confirm() {
		layCloseFunc()
	}

	function land() {
		//localStorage.clear()
		if (checkValueFunc() && checkInputLength()) {
			let userName = $('#input_uname').val()
			let userPwd = $('#input_upwd').val()

			let landInfo = {userName: userName, userPwd: userPwd}
			console.log(`userName is: ${userName}, userPwd is: ${userPwd}`)
			post_ajax('land', '/landing', landInfo, (response) => {
				let flag = response.flag
				console.log(`flag is: ${flag}`)
				if (1 == flag) {
					let token = response.token
					let localIP = response.localIP
					localStorage.setItem("AIC_TOKEN", token)
					//window.location.href = baseUrlLocal + '/html/test_upload.html'
					let serverIP = response.serverIP
					//alert('server ip: '+serverIP)
					window.location.href = 'http://' + serverIP + ':8080/index.html?token=' + token + '&localIP=' + localIP
				} else if (203 == flag) {
					layOpenFunc1()
				} else {
					$('#landing_tips').html('账号与密码不匹配, 请核实后登录!')
					$('#landing_tips').show()
				}
			})
		} else {
			$('#landing_tips').html('输入不合法,请重新输入!')
			$('#landing_tips').show()
		}
	}
</script>
</html>